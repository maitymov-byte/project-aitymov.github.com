<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Astana Computer Market — Торговая платформа периферии</title>
  <style>
    :root{
      --accent:#1f6feb;
      --muted:#666;
      --card:#fff;
      --bg:#f5f7fb;
      --danger:#d9534f;
      --success:#28a745;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
    body{margin:0;background:var(--bg);color:#111}
    header{background:linear-gradient(90deg,#0b2342 0%, #113a60 100%);color:#fff;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{font-weight:700;letter-spacing:0.6px}
    nav{display:flex;gap:10px;align-items:center}
    nav button{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    .hero{display:flex;gap:20px;align-items:center;justify-content:space-between;background:linear-gradient(90deg,#fff 0%, #fff 100%);padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    .hero-left h1{margin:0 0 8px;font-size:22px}
    .controls{display:flex;gap:8px;align-items:center}
    input[type="search"],select{padding:10px;border-radius:8px;border:1px solid #ddd;outline:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 14px rgba(16,24,40,0.04);display:flex;flex-direction:column;gap:8px}
    .card img{width:100%;height:140px;object-fit:contain;background:#f8f9fb;border-radius:6px}
    .price{font-weight:700}
    .status{padding:6px 8px;border-radius:999px;font-size:12px;display:inline-block}
    .btn{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    footer{margin:26px 0;text-align:center;color:var(--muted)}
    .top-row{display:flex;gap:12px;align-items:center}
    .right-col{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;padding:20px;z-index:999;display:none}
    .modal.open{display:flex}
    .modal .box{background:#fff;padding:18px;border-radius:12px;max-width:480px;width:100%}
    label{display:block;margin-top:8px;font-size:13px;color:#333}
    textarea{width:100%;min-height:90px;padding:10px;border-radius:8px;border:1px solid #ddd}
    .flex{display:flex;gap:8px;align-items:center}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #eee;background:#fafafa;font-size:13px}
    .survey{display:flex;flex-direction:column;gap:10px}
    .badge{font-size:12px;padding:4px 8px;border-radius:8px;background:#f0f6ff;color:var(--accent)}
    .hidden{display:none}
    @media(max-width:720px){ .hero{flex-direction:column;align-items:stretch} header{flex-direction:column;align-items:flex-start;gap:12px} }
  </style>
</head>
<body>

<header>
  <div class="logo">Astana Computer Market</div>
  <nav>
    <button id="openCatalogBtn">Каталог</button>
    <button id="openContactsBtn">Контакты</button>
    <button id="openSurveyBtn">Опрос</button>
    <div id="authArea" style="display:flex;gap:8px;align-items:center;margin-left:10px">
      <span class="small" id="userGreeting">Вы не вошли</span>
      <button class="btn" id="openRegisterBtn">Вход / Регистрация</button>
    </div>
  </nav>
</header>

<main class="container">
  <section class="hero">
    <div class="hero-left">
      <h1>Торговая платформа — компьютерная периферия в Астане</h1>
      <p class="small">Каталог локальных товаров, статус наличия, связь с продавцом и опрос для пользователей.</p>
      <div style="margin-top:10px" class="top-row">
        <span class="chip">Доставка: Самовывоз / Курьер</span>
        <span class="chip">Оплата: Нал/Карта</span>
      </div>
    </div>

    <div class="hero-right" style="min-width:260px">
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="flex">
          <input id="searchInput" type="search" placeholder="Поиск товара (например: клавиатура, Logitech)" style="flex:1">
          <select id="categorySelect">
            <option value="">Все категории</option>
          </select>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="showAllBtn">Показать всё</button>
          <button id="showMissingBtn" style="padding:8px 10px;border-radius:8px;border:1px solid #ddd;background:#fff">Показать: нет в наличии</button>
        </div>
      </div>
    </div>
  </section>

  <section style="margin-top:18px">
    <h2 style="margin:0 0 8px">Каталог</h2>
    <div id="catalog" class="grid" aria-live="polite"></div>
    <p class="small" style="margin-top:10px">Подсказка: Нажми "Сообщить о поступлении" если товара нет в наличии — продавец получит запрос.</p>
  </section>

  <section style="margin-top:24px;display:flex;gap:20px;flex-wrap:wrap">
    <div style="flex:1;min-width:260px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 14px rgba(16,24,40,0.04)">
      <h3 style="margin-top:0">Форма обратной связи</h3>
      <form id="contactForm">
        <label>Имя <input id="contactName" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></label>
        <label>Email <input id="contactEmail" type="email" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></label>
        <label>Сообщение <textarea id="contactMessage" required></textarea></label>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" type="submit">Отправить</button>
          <button id="clearContact" type="button" style="padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff">Очистить</button>
        </div>
        <div id="contactResult" class="small" style="margin-top:8px"></div>
      </form>
    </div>

    <div style="flex:1;min-width:260px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 14px rgba(16,24,40,0.04)">
      <h3 style="margin-top:0">Опрос (быстро)</h3>
      <form id="surveyForm" class="survey">
        <label>Нашли ли вы нужную периферию?
          <select id="surveyFound">
            <option value="yes">Да</option>
            <option value="no">Нет</option>
            <option value="partial">Частично</option>
          </select>
        </label>
        <label>Оцените удобство сайта (1-5)
          <select id="surveyRate">
            <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
          </select>
        </label>
        <label>Комментарий <input id="surveyComment" placeholder="Короткий отзыв" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></label>
        <div style="display:flex;gap:8px">
          <button class="btn" type="submit">Отправить опрос</button>
          <button id="viewSurvey" type="button" style="padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff">Показать результаты</button>
        </div>
        <div id="surveyResult" class="small" style="margin-top:8px"></div>
      </form>
    </div>
  </section>

  <section id="contactsSection" style="margin-top:24px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 14px rgba(16,24,40,0.04)">
    <h3 style="margin-top:0">Контакты</h3>
    <p class="small">Адрес: Астана, пр. Независимости (пример). Телефон: +7 (700) 000-0000</p>
    <div id="mapPlaceholder" style="width:100%;height:200px;background:#eef2fb;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Здесь можно вставить Google Maps</div>
  </section>

  <footer>
    <p class="small">Демо-платформа — учебный проект. Тестирование: попросите однокурсников зарегистрироваться, найти товар и отправить отзыв.</p>
  </footer>
</main>

<!-- Modals -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="box">
    <div id="modalContent"></div>
    <div style="margin-top:12px;text-align:right">
      <button id="closeModal" style="padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff">Закрыть</button>
    </div>
  </div>
</div>

<script>
  const sampleProducts = [
    {id:1,name:'Клавиатура Logitech K120',category:'Клавиатуры',price:8900,brand:'Logitech',inStock:true,img:''},
    {id:2,name:'Мышь Logitech M185',category:'Мыши',price:6500,brand:'Logitech',inStock:false,img:''},
    {id:3,name:'Игровая мышь Razer Basilisk',category:'Мыши',price:32000,brand:'Razer',inStock:true,img:''},
    {id:4,name:'Наушники HyperX Cloud II',category:'Наушники',price:42000,brand:'HyperX',inStock:false,img:''},
    {id:5,name:'Монитор Samsung 24\" 75Hz',category:'Мониторы',price:78000,brand:'Samsung',inStock:true,img:''},
    {id:6,name:'Веб-камера Logitech C270',category:'Веб-камеры',price:15000,brand:'Logitech',inStock:true,img:''},
    {id:7,name:'Коврик для мыши SteelSeries',category:'Коврики',price:5200,brand:'SteelSeries',inStock:false,img:''}
  ];

  const STORAGE_KEYS = {
    PRODUCTS: 'astana_products_v1',
    USERS: 'astana_users_v1',
    CONTACTS: 'astana_contacts_v1',
    SURVEY: 'astana_survey_v1',
    SESSION: 'astana_session_v1'
  };

  function loadProducts(){
    const raw = localStorage.getItem(STORAGE_KEYS.PRODUCTS);
    if(raw) return JSON.parse(raw);
    localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(sampleProducts));
    return sampleProducts;
  }
  function saveProducts(products){
    localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
  }

  let products = loadProducts();

  const catalogEl = document.getElementById('catalog');
  const categorySelect = document.getElementById('categorySelect');
  function getCategories(){
    const cats = [...new Set(products.map(p => p.category))].sort();
    return cats;
  }
  function fillCategoryOptions(){
    const cats = getCategories();
    categorySelect.innerHTML = '<option value="">Все категории</option>';
    cats.forEach(c => {
      const o = document.createElement('option'); o.value = c; o.textContent = c; categorySelect.appendChild(o);
    });
  }

  function renderCatalog(filter = ''){
    catalogEl.innerHTML = '';
    const search = document.getElementById('searchInput').value.trim().toLowerCase();
    const category = categorySelect.value;
    const showMissing = document.getElementById('showMissingBtn').dataset.filter === 'missing';
    const list = products.filter(p => {
      if(search && !(p.name.toLowerCase().includes(search) || p.brand.toLowerCase().includes(search))) return false;
      if(category && p.category !== category) return false;
      if(showMissing && p.inStock) return false;
      return true;
    });

    if(list.length === 0){
      catalogEl.innerHTML = '<div style="padding:20px;background:#fff;border-radius:10px;grid-column:1/-1">Ничего не найдено.</div>';
      return;
    }

    list.forEach(p => {
      const div = document.createElement('div'); div.className='card';
      const img = document.createElement('img');
      img.alt = p.name;
      img.src = p.img || 'data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="600" height="400"><rect width="100%" height="100%" fill="#f6f8fb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#cbd5e1" font-size="20">${p.category}</text></svg>`);
      div.appendChild(img);

      const nm = document.createElement('div'); nm.innerHTML = `<div style="font-weight:600">${p.name}</div><div class="small">${p.brand} · ${p.category}</div>`;
      div.appendChild(nm);

      const foot = document.createElement('div'); foot.style.marginTop='auto';
      const price = document.createElement('div'); price.className='price'; price.textContent = p.price ? (p.price.toLocaleString()+' ₸') : '---';
      foot.appendChild(price);

      const status = document.createElement('div');
      status.className='status';
      status.textContent = p.inStock ? 'В наличии' : 'Нет в наличии';
      status.style.background = p.inStock ? 'rgba(40,167,69,0.08)' : 'rgba(217,83,79,0.06)';
      status.style.color = p.inStock ? 'var(--success)' : 'var(--danger)';
      status.style.marginTop = '6px';
      foot.appendChild(status);

      const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='8px';
      const detailsBtn = document.createElement('button'); detailsBtn.className='btn'; detailsBtn.textContent='Подробнее';
      detailsBtn.onclick = ()=> openProductModal(p.id);
      actions.appendChild(detailsBtn);

      const notifyBtn = document.createElement('button'); notifyBtn.textContent = p.inStock ? 'Купить' : 'Сообщить о поступлении';
      notifyBtn.style.padding='8px'; notifyBtn.style.borderRadius='8px'; notifyBtn.style.border='1px solid #ddd'; notifyBtn.style.background='#fff';
      notifyBtn.onclick = ()=> handleNotify(p.id);
      actions.appendChild(notifyBtn);

      foot.appendChild(actions);
      div.appendChild(foot);

      catalogEl.appendChild(div);
    });
  }

  const modal = document.getElementById('modal');
  const modalContent = document.getElementById('modalContent');
  document.getElementById('closeModal').addEventListener('click', ()=> closeModal());

  function openModal(html){
    modalContent.innerHTML = html;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
  }
  function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }

  function openProductModal(productId){
    const p = products.find(x=>x.id===productId);
    if(!p) return;
    openModal(`
      <h3 style="margin-top:0">${p.name}</h3>
      <p class="small">${p.brand} · ${p.category}</p>
      <p style="font-weight:700;margin:8px 0">${p.price.toLocaleString()} ₸</p>
      <p>Статус: <strong>${p.inStock ? 'В наличии' : 'Нет в наличии'}</strong></p>
      <p class="small">Описание: базовая карточка товара (демо).</p>
      <div style="display:flex;gap:8px;margin-top:12px">
        ${p.inStock ? `<button class="btn" onclick="alert('Оформление заказа (демо)')">Оформить заказ</button>` : `<button onclick="handleNotify(${p.id})" style="padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff">Сообщить о поступлении</button>`}
        <button style="padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff" onclick="closeModal()">Закрыть</button>
      </div>
    `);
  }

  function handleNotify(productId){
    const p = products.find(x=>x.id===productId);
    if(!p) return;
    const contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.CONTACTS) || '[]');
    contacts.push({type:'notify',productId,productName:p.name,email:currentUser()?currentUser().email:'(гость)',time:new Date().toISOString()});
    localStorage.setItem(STORAGE_KEYS.CONTACTS, JSON.stringify(contacts));
    alert('Спасибо! Продавец получит уведомление о вашем запросе.');
  }

  function currentUser(){
    const sid = localStorage.getItem(STORAGE_KEYS.SESSION);
    if(!sid) return null;
    const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS) || '[]');
    return users.find(u=>u.id === sid) || null;
  }

  document.getElementById('openRegisterBtn').addEventListener('click', ()=>{
    openModal(`
      <h3 style="margin-top:0">Вход / Регистрация</h3>
      <div>
        <form id="authForm">
          <label>Имя <input id="authName" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></label>
          <label>Email <input id="authEmail" type="email" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></label>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" type="submit">Зарегистрироваться / Войти</button>
            <button type="button" id="logoutBtn" style="padding:8px;border-radius:8px;border:1px solid #ddd;background:#fff">Выйти</button>
          </div>
        </form>
        <div id="authResult" class="small" style="margin-top:8px"></div>
      </div>
    `);
    document.getElementById('authForm').addEventListener('submit', event=>{
      event.preventDefault();
      const name = document.getElementById('authName').value.trim();
      const email = document.getElementById('authEmail').value.trim().toLowerCase();
      if(!email || !name){ document.getElementById('authResult').textContent='Заполните поля'; return; }
      let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS) || '[]');
      let user = users.find(u=>u.email===email);
      if(!user){
        user = {id: 'u'+Date.now(), name, email, created: new Date().toISOString()};
        users.push(user);
        localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
      }
      localStorage.setItem(STORAGE_KEYS.SESSION, user.id);
      document.getElementById('authResult').textContent = 'Вы успешно вошли как ' + user.name;
      updateAuthUI();
      setTimeout(()=>closeModal(),900);
    });
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem(STORAGE_KEYS.SESSION);
      updateAuthUI();
      document.getElementById('authResult').textContent = 'Вы вышли';
    });
  });

  function updateAuthUI(){
    const user = currentUser();
    const area = document.getElementById('authArea');
    const greet = document.getElementById('userGreeting');
    if(user){
      greet.textContent = 'Привет, ' + user.name;
      document.getElementById('openRegisterBtn').textContent = 'Мой профиль';
    } else {
      greet.textContent = 'Вы не вошли';
      document.getElementById('openRegisterBtn').textContent = 'Вход / Регистрация';
    }
  }

  document.getElementById('contactForm').addEventListener('submit', event=>{
    event.preventDefault();
    const name = document.getElementById('contactName').value.trim();
    const email = document.getElementById('contactEmail').value.trim();
    const message = document.getElementById('contactMessage').value.trim();
    const contacts = JSON.parse(localStorage.getItem(STORAGE_KEYS.CONTACTS) || '[]');
    contacts.push({type:'contact',name,email,message,time:new Date().toISOString(),user: currentUser()?currentUser().email:null});
    localStorage.setItem(STORAGE_KEYS.CONTACTS, JSON.stringify(contacts));
    document.getElementById('contactResult').textContent = 'Сообщение отправлено — спасибо!';
    document.getElementById('contactForm').reset();
  });
  document.getElementById('clearContact').addEventListener('click', ()=> document.getElementById('contactForm').reset());

  document.getElementById('surveyForm').addEventListener('submit', e=>{
    e.preventDefault();
    const found = document.getElementById('surveyFound').value;
    const rate = document.getElementById('surveyRate').value;
    const comment = document.getElementById('surveyComment').value.trim();
    const arr = JSON.parse(localStorage.getItem(STORAGE_KEYS.SURVEY) || '[]');
    arr.push({found,rate,comment,time:new Date().toISOString(),user: currentUser()?currentUser().email:null});
    localStorage.setItem(STORAGE_KEYS.SURVEY, JSON.stringify(arr));
    document.getElementById('surveyResult').textContent = 'Спасибо за ответ!';
    document.getElementById('surveyForm').reset();
  });
  document.getElementById('viewSurvey').addEventListener('click', ()=>{
    const arr = JSON.parse(localStorage.getItem(STORAGE_KEYS.SURVEY) || '[]');
    if(arr.length===0){ alert('Результатов пока нет'); return;}
    const sum = arr.reduce((s,r)=>s+parseInt(r.rate||0,10),0);
    const avg = (sum/arr.length).toFixed(2);
    const foundCounts = arr.reduce((o,r)=>{ o[r.found]=(o[r.found]||0)+1; return o}, {});
    openModal(`<h3>Результаты опроса</h3>
      <p>Ответов: <strong>${arr.length}</strong></p>
      <p>Средняя оценка: <strong>${avg}</strong></p>
      <p>Нашли ли нужную периферию: <strong>${JSON.stringify(foundCounts)}</strong></p>
      <div style="max-height:220px;overflow:auto;margin-top:8px">${arr.map(a=>`<div style="padding:8px;border-bottom:1px solid #f1f5f9"><div class="small">${a.time} ${a.user?('· '+a.user):''}</div><div>Оценка: ${a.rate}, Нашли: ${a.found}</div><div class="small">${a.comment||''}</div></div>`).join('')}</div>
    `);
  });

  document.getElementById('searchInput').addEventListener('input', ()=> renderCatalog());
  categorySelect.addEventListener('change', ()=> renderCatalog());
  document.getElementById('showAllBtn').addEventListener('click', ()=> {
    document.getElementById('showMissingBtn').dataset.filter = '';
    renderCatalog();
  });
  document.getElementById('showMissingBtn').addEventListener('click', (e)=>{
    const btn = e.currentTarget;
    if(btn.dataset.filter === 'missing'){ btn.dataset.filter=''; btn.style.border='1px solid #ddd'; } else { btn.dataset.filter='missing'; btn.style.border='2px solid var(--accent)'; }
    renderCatalog();
  });

  document.getElementById('openCatalogBtn').addEventListener('click', ()=> window.scrollTo({top:140,behavior:'smooth'}));
  document.getElementById('openContactsBtn').addEventListener('click', ()=> {
    document.getElementById('contactsSection').scrollIntoView({behavior:'smooth'});
  });
  document.getElementById('openSurveyBtn').addEventListener('click', ()=> {
    document.getElementById('surveyForm').scrollIntoView({behavior:'smooth'});
  });

  fillCategoryOptions();
  updateAuthUI();
  renderCatalog();

  window.__adminToggleStock = function(productId){
    products = products.map(p => p.id===productId ? {...p, inStock: !p.inStock} : p);
    saveProducts(products);
    renderCatalog();
  };

  let logoClicks = 0;
  document.querySelector('.logo').addEventListener('click', ()=>{
    logoClicks++;
    if(logoClicks >= 5){
      logoClicks = 0;
      openModal(`<h3>Инструменты разработчика (демо)</h3>
        <p class="small">Список товаров:</p>
        <div style="max-height:300px;overflow:auto">${products.map(p=>`<div style="padding:8px;border-bottom:1px solid #f1f5f9">${p.name} — <strong>${p.inStock? 'В наличии':'Нет'}</strong> <button onclick="__adminToggleStock(${p.id})" style="margin-left:8px;padding:6px;border-radius:6px">Переключить наличие</button></div>`).join('')}</div>
      `);
    }
    setTimeout(()=> logoClicks = 0,1500);
  });

  console.log('Demo site loaded. Products in localStorage key:', STORAGE_KEYS.PRODUCTS);
</script>

</body>
</html>
